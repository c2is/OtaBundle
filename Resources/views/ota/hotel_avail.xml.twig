<?xml version="1.0" encoding="utf-8"?>
<OTA_HotelAvailRQ
        EchoToken="{{ echo }}"
        {% if locale is defined -%}
        PrimaryLangID="{{ locale }}"
        {% endif -%}
        Target="{{ target | default('Test') }}"
        TimeStamp="{{ timestamp }}"
        Version="{{ ota.version }}"
        xmlns="{{ ota.namespace }}"
        MaxResponses="{{ max_responses | default('100') }}"
        BestOnly="{{ best_only | default('false') }}"
        RateRangeOnly="{{ rate_range_only | default('true') }}"
        SummaryOnly="{{ summary_only | default('false') }}">
    <POS>
        <Source>
            <RequestorID ID="{{ requestor.id }}" Type="{{ requestor.type }}">
                <CompanyName>{{ company_name }}</CompanyName>
            </RequestorID>
        </Source>
    </POS>
    <AvailRequestSegments>
        <AvailRequestSegment AvailReqType="{{ type | default('Room') }}">
            {% if date_range is defined and date_range.start_date is defined and date_range.end_date is defined -%}
            <StayDateRange Start="{{ date_range.start_date | date('Y-m-d') }}" End="{{ date_range.end_date | date('Y-m-d') }}"{% if date_range.duration is defined %} Duration="{{ date_range.duration }}"{% endif %}>
                <DateWindowRange>{{ date_range.start_date | date('Y-m-d') }}</DateWindowRange>
            </StayDateRange>
            {%- endif -%}
            {%- if rate_range_only is defined and rate_range_only and rate_range is defined -%}
            <RateRange MinRate="{{ rate_range.min | default('0') }}" MaxRate="{{ rate_range.max | default('5000') }}" CurrencyCode="{{ rate_range.currency | default('EUR') }}" />
            {%- endif -%}
            {% if rooms is defined %}
            <RoomStayCandidates>
                {% for room in rooms %}
                <RoomStayCandidate Quantity="{{ room.count }}">
                    <GuestCounts>
                        {% for guest in room.guests %}
                        <GuestCount {% if guest.age is defined %}Age="{{ guest.age }}" {% endif %}AgeQualifyingCode="{{ guest.category | default('10') }}" Count="{{ guest.count | default('1') }}"/>
                        {% endfor %}
                    </GuestCounts>
                </RoomStayCandidate>
                {% endfor %}
            </RoomStayCandidates>
            {% endif %}
            <HotelSearchCriteria>
                <Criterion>
                    <HotelRef ChainCode="{{ hotel.chain_code }}" HotelCode="{{ hotel.code }}" />
                </Criterion>
            </HotelSearchCriteria>
        </AvailRequestSegment>
    </AvailRequestSegments>
</OTA_HotelAvailRQ>
